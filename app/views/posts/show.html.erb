<%= stylesheet_link_tag "buttons", "forms" %>

<div class="post-container">
  <h1 class="post-title"><%= @post.title %></h1>
  <p class="post-meta"><%= "Created at " + @post.created_at.strftime('%d %B, %Y') %></p>
  <div class="post-meta">
   <%= link_to "Created by " + @post.user.email, user_path(@post.user) %>
  </div>

  <div class="post-content">
    <%= @post.body %>

  </div>
  <div class="post-votes">
    <%="Votos del post: #{@post.total_votes}" %>

  </div>
  </div>
  <form class="vote-form" data-post-id="<%= @post.id %>">
  <button type="button" class="vote-up">+</button>
  <button type="button" class="vote-down">-</button>
</form>

  <div class="comments-section">
    <h2><%= "Comments" %></h2>
    <ul class="comments-list">
      <% @post.comments.each do |comment| %>
        <li class="comment">
          <div class="comment-body"><%= comment.body %></div>
          <p class="post-meta"><%= "Created at " + comment.created_at.strftime('%d %B, %Y') %></p>
          <div class="post-meta">
           <%= link_to "Created by " + comment.user.email, user_path(comment.user) %>
          </div>
        </li>
      <% end %>
    </ul>
  </div>

  <% if user_signed_in? %>
  <h2><%= "Add a comment" %></h2>
  <%= form_with(model: [@post, Comment.new], local: true, html: { class: "comment-form" } ) do |form| %>
    <div class="field">
      <%= form.text_area :body, placeholder: "Write your comment here", class: "form-text-input__inner" %>
    </div>
    <%= form.hidden_field :post_id, value: @post.id %>
    <%= form.hidden_field :user_id, value: current_user.id %>
    <%= form.hidden_field :community_id, value: @post.community_id %>
    <div class="actions">
      <%= form.submit "Comenta", class: "generic-button" %>
    </div>
  <% end %>
  <% else %>
  <p>Debes iniciar sesi√≥n para dejar un comentario.</p>
  <% end %>

</div>
</div>

<script>
  $(document).ready(function() {
    $('.vote-form').on('click', '.vote-up, .vote-down', function() {
      const postId = $(this).closest('.vote-form').data('post-id');
      const voteType = $(this).hasClass('vote-up') ? 'vote_up' : 'vote_down';
      
      $.ajax({
        type: 'POST',
        url: `/posts/${postId}/${voteType}`,
        dataType: 'json',
        success: function(data) {
          $('.vote-count').text(data.votes); // Actualiza el contador de votos
        },
        error: function(xhr, status, error) {
          // Manejar errores de la solicitud Ajax
        }
      });
    });
  });
</script>