<%= stylesheet_link_tag "buttons", "forms" %>

<div class="post-container">
  <h1 class="post-title"><%= @post.title %></h1>
  <p class="post-meta"><%= "Created at " + @post.created_at.strftime('%d %B, %Y') %></p>
  <div class="post-meta">
   <%= link_to "Created by " + @post.user.email, user_path(@post.user) %>
  </div>

  <div class="post-content">
    <%= @post.body %>

  </div>
  <div class="post-votes">
    <%="Votos del post: #{@post.total_votes}" %>

  </div>
  </div>
  <form class="vote-form" data-post-id="<%= @post.id %>">
  <button type="button" class="vote-up">+</button>
  <button type="button" class="vote-down">-</button>
</form>

<div class="comments-section">
  <h2><%= "Comments" %></h2>
  <ul class="comments-list">
    <% @post.comments.where(parent_id: nil).each do |comment| %>
      <%= render partial: 'comments/comment', locals: { comment: comment } %>
    <% end %>
  </ul>
</div>

  <% if user_signed_in? %>
  <%= render partial: 'comments/form', locals: { post: @post, community: @community } %>
  
  <% else %>
  <p>Debes iniciar sesi√≥n para dejar un comentario.</p>
  <% end %>

</div>
</div>

<script>
  $(document).ready(function() {
    $('.vote-form').on('click', '.vote-up, .vote-down', function() {
      const postId = $(this).closest('.vote-form').data('post-id');
      const voteType = $(this).hasClass('vote-up') ? 'vote_up' : 'vote_down';
      
      $.ajax({
        type: 'POST',
        url: `/posts/${postId}/${voteType}`,
        dataType: 'json',
        success: function(data) {
          $('.vote-count').text(data.votes); // Actualiza el contador de votos
        },
        error: function(xhr, status, error) {
          // Manejar errores de la solicitud Ajax
        }
      });
    });
  });
</script>